--
-- Copyright (c) 2022, Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0
--

module Tests.BankBICsTest where

import Daml.Script

import DA.Foldable
import qualified DA.List as L
import qualified DA.Set as S

import Tests.PartyAlloc
import Model.BankBIC

createBankBICs banksWithBICs schedulers assemblers = do
  forA_ banksWithBICs (\(banks, bic) -> submit (L.head $ S.toList banks) $ createCmd BankBIC with ..)
  pure ()


populateBanks : Script ()
populateBanks = script do
  Banks{cb, bank11, bank12, bank21, bank22} <- actionPartyAllocation
  ServiceParties{scheduler, assembler} <- servicePartyAllocation

  let
    actionParties = [bank12, bank11, bank21, bank22, cb]
    assemblerSet = S.singleton assembler
    schedulerSet = S.singleton scheduler
    actionPartiesBICS = ["BANK12_BIC", "BANK11_BIC", "BANK21_BIC", "BANK22_BIC", "BANKCB_BIC"]
    banksWithBICs = zipWith (\bank bic -> (S.singleton bank, bic)) actionParties actionPartiesBICS

  createBankBICs banksWithBICs schedulerSet assemblerSet
